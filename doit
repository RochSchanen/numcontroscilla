#!/bin/bash

STOP_TIME="50ns"

#########
# analyze
#########

echo "analyse ./bench/*"
ghdl -a ./bench/benchclock.vhdl
ghdl -a ./bench/benchreset.vhdl
ghdl -a --ieee=synopsys ./bench/benchrom.vhdl
ghdl -a --ieee=synopsys ./bench/benchcounter.vhdl

echo "analyse ./nco/*"
ghdl -a ./nco/fifobuf.vhdl
ghdl -a ./nco/addsync.vhdl
ghdl -a ./nco/plcnt.vhdl
ghdl -a ./nco/placc.vhdl
ghdl -a ./nco/plnco.vhdl

echo "analyse ./plpr/*"
ghdl -a --ieee=synopsys ./plpr/plpr.vhdl
ghdl -a ./plpr/fifostream.vhdl

echo "analyse ./*_bench.vhdl"
# ghdl -a -fsynopsys ./fpga_bench.vhdl
# ghdl -a --ieee=synopsys ./plpr_bench.vhdl
ghdl -a ./fifostream_bench.vhdl

###########
# elaborate
###########

echo "elaborate"
# ghdl -e -fsynopsys fpga_bench
# ghdl -e -fsynopsys plpr_bench
ghdl -e fifostream_bench

################
# run and export
################

echo "run"
# ghdl -r -fsynopsys plpr_bench --stop-time=${STOP_TIME} --vcd=.outputs/bench.vcd
ghdl -r fifostream_bench --stop-time=${STOP_TIME} --vcd=.outputs/bench.vcd

##########
# clean up
##########

rm work-obj93.cf

######
# done
######

echo "done."
